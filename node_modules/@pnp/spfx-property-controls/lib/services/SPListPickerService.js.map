{"version":3,"sources":["services/SPListPickerService.ts"],"names":[],"mappings":"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","file":"services/SPListPickerService.js","sourcesContent":["import { SPHttpClientResponse } from '@microsoft/sp-http';\nimport { SPHttpClient } from '@microsoft/sp-http';\nimport { Environment, EnvironmentType } from '@microsoft/sp-core-library';\nimport { IWebPartContext } from '@microsoft/sp-webpart-base';\nimport { ISPLists, IPropertyFieldListPickerHostProps, ISPList } from '../propertyFields/listPicker/IPropertyFieldListPickerHost';\nimport { PropertyFieldListPickerOrderBy } from '../propertyFields/listPicker/IPropertyFieldListPicker';\nimport SPListPickerMockHttpClient from './SPListPickerMockService';\n\n/**\n * Service implementation to get list & list items from current SharePoint site\n */\nexport default class SPListPickerService {\n\n  private context: IWebPartContext;\n  private props: IPropertyFieldListPickerHostProps;\n\n  /**\n   * Service constructor\n   */\n  constructor(_props: IPropertyFieldListPickerHostProps, pageContext: IWebPartContext) {\n    this.props = _props;\n    this.context = pageContext;\n  }\n\n  /**\n   * Gets the collection of libs in the current SharePoint site, or target site if specified by webRelativeUrl\n   */\n  public async getLibs(): Promise<ISPLists> {\n    if (Environment.type === EnvironmentType.Local) {\n      // If the running environment is local, load the data from the mock\n      return this.getLibsFromMock();\n    }\n    else {\n      // use the web relative url if provided, otherwise default to current SharePoint site\n      const webAbsoluteUrl = this.props.webAbsoluteUrl ? this.props.webAbsoluteUrl : this.context.pageContext.web.absoluteUrl;\n      // If the running environment is SharePoint, request the lists REST service\n      let queryUrl: string = `${webAbsoluteUrl}/_api/lists?$select=Title,id,BaseTemplate`;\n      // Check if the orderBy property is provided\n      if (this.props.orderBy !== null) {\n        queryUrl += '&$orderby=';\n        switch (this.props.orderBy) {\n          case PropertyFieldListPickerOrderBy.Id:\n            queryUrl += 'Id';\n            break;\n          case PropertyFieldListPickerOrderBy.Title:\n            queryUrl += 'Title';\n            break;\n        }\n      }\n\n      // Adds an OData Filter to the list\n      if (this.props.filter){\n        queryUrl += `&$filter=${encodeURIComponent(this.props.filter)}`;\n      }\n      // Check if the list have get filtered based on the list base template type\n      else if (this.props.baseTemplate !== null && this.props.baseTemplate) {\n        queryUrl += '&$filter=BaseTemplate%20eq%20';\n        queryUrl += this.props.baseTemplate;\n        // Check if you also want to exclude hidden list in the list\n        if (this.props.includeHidden === false) {\n          queryUrl += '%20and%20Hidden%20eq%20false';\n        }\n      } else {\n        if (this.props.includeHidden === false) {\n          queryUrl += '&$filter=Hidden%20eq%20false';\n        }\n      }\n      let response = await this.context.spHttpClient.get(queryUrl, SPHttpClient.configurations.v1);\n\n      let lists = (await response.json()) as ISPLists;\n\n      // Check if onListsRetrieved callback is defined\n      if(this.props.onListsRetrieved){\n        //Call onListsRetrieved\n        let lr = this.props.onListsRetrieved(lists.value);\n        let output: ISPList[];\n\n        //Conditional checking to see of PromiseLike object or array\n        if(lr instanceof Array){\n\n          output = lr;\n        }else{\n          output = await lr;\n        }\n\n        lists = {\n          value: output\n        };\n      }\n      return lists;\n    }\n\n  }\n\n  /**\n   * Returns 3 fake SharePoint lists for the Mock mode\n   */\n  private getLibsFromMock(): Promise<ISPLists> {\n    return SPListPickerMockHttpClient.getLists(this.context.pageContext.web.absoluteUrl).then(() => {\n      const listData: ISPLists = {\n        value:\n        [\n          { Title: 'Mock List One', Id: '6770c83b-29e8-494b-87b6-468a2066bcc6', BaseTemplate: '109' },\n          { Title: 'Mock List Two', Id: '2ece98f2-cc5e-48ff-8145-badf5009754c', BaseTemplate: '109' },\n          { Title: 'Mock List Three', Id: 'bd5dbd33-0e8d-4e12-b289-b276e5ef79c2', BaseTemplate: '109' }\n        ]\n      };\n      return listData;\n    }) as Promise<ISPLists>;\n  }\n}\n"],"sourceRoot":"../../src"}